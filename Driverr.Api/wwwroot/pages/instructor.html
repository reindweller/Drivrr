<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Drivrr Admin - Instructor</title>

    <!-- Bootstrap Core CSS -->
    <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- MetisMenu CSS -->
    <link href="../vendor/metisMenu/metisMenu.min.css" rel="stylesheet">

    <!-- DataTables CSS -->
    <link href="../vendor/datatables-plugins/dataTables.bootstrap.css" rel="stylesheet">

    <!-- DataTables Responsive CSS -->
    <link href="../vendor/datatables-responsive/dataTables.responsive.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="../dist/css/sb-admin-2.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>
    <div id="wrapper">
        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html">Drivrr Admin</a>
            </div>
            <!-- /.navbar-header -->
            <ul class="nav navbar-top-links navbar-right">
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-user fa-fw"></i> <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li>
                            <a href="#"><i class="fa fa-user fa-fw"></i> User Profile</a>
                        </li>
                        <li>
                            <a href="#"><i class="fa fa-gear fa-fw"></i> Settings</a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="login.html"><i class="fa fa-sign-out fa-fw"></i> Logout</a>
                        </li>
                    </ul>
                    <!-- /.dropdown-user -->
                </li>
                <!-- /.dropdown -->
            </ul>
            <!-- /.navbar-top-links -->
            <div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav navbar-collapse">
                    <ul class="nav" id="side-menu">
                        <li>
                            <a href="index.html"><i class="fa fa-home fa-fw"></i> Home</a>
                        </li>
                        <li>
                            <a href="instructor.html"><i class="fa fa-car fa-fw"></i> Driving Instructors</a>
                        </li>
                        <li>
                            <a href="users.html"><i class="fa fa-users fa-fw"></i> Users</a>
                        </li>
                    </ul>
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>
        <div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header">Driving Instructors</h1>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <button id="btnAdd" type="button" class="btn btn-primary" data-toggle="modal" data-target="#add-modal">Add</button>
                            <button id="btnEdit" type="button" class="btn btn-warning">Edit</button>
                            <button id="btnView" type="button" class="btn btn-info">View</button>
                            <button id="btnDelete" type="button" class="btn btn-danger">Delete</button>
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            <table class="table table-striped table-bordered table-hover" id="instructor-table">
                                <thead>
                                    <tr>
                                        <th class="">Id</th>
                                        <th class="col-lg-2">Name</th>
                                        <th class="col-lg-2">Email</th>
                                        <th class="col-lg-2">Address</th>
                                        <th class="col-lg-2">School</th>
                                        <th class="col-lg-2">Phone</th>
                                        <th class="col-lg-2">Mobile</th>
                                        <th class="col-lg-1">Price</th>
                                    </tr>
                                </thead>
                                <tfoot>
                                    <tr>
                                        <th>Id</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Address</th>
                                        <th>School</th>
                                        <th>Phone</th>
                                        <th>Mobile</th>
                                        <th>Price</th>
                                    </tr>
                                </tfoot>
                            </table>
                            <!-- /.table-responsive -->
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
        </div>
        <!-- /#page-wrapper -->
    </div>
    <!-- /#wrapper -->
    <!-- Modal -->
    <div id="add-modal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Add Driving Instructor</h4>
                </div>
                <div class="modal-body">
                    <form action="/action_page.php">
                        <input type="hidden" class="form-control" id="id" />
                        <div class="form-group">
                            <label for="firstName">First Name:</label>
                            <input type="text" class="form-control" id="firstName" />
                        </div>
                        <div class="form-group">
                            <label for="lastName">Last Name:</label>
                            <input type="text" class="form-control" id="lastName" />
                        </div>
                        <div class="form-group">
                            <label for="state">State:</label>
                            <select class="form-control" id="state">
                                <option>New South Wales</option>
                                <option>Victoria</option>
                                <option>Queensland</option>
                                <option>Western Australia</option>
                                <option>South Australia</option>
                                <option>Australian Capital Territory</option>
                                <option>Tasmania</option>
                                <option>Northern Territory</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="suburb">Suburb:</label>
                            <select class="form-control" id="suburb">
                                <option>Aarons Pass</option>
                                <option>Agnes Banks</option>
                                <option>Falmouth</option>
                                <option>Gapsted</option>
                                <option>Ilparpa</option>
                                <option>Jancourt East</option>
                                <option>Lagrange</option>
                                <option>Macleay Island</option>
                                <option>Melbourne</option>
                                <option>Nambour Bc</option>
                                <option>Oakwood</option>
                                <option>Queenstown</option>
                                <option>Salt Creek</option>
                                <option>Vasse</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="postCode">PostCode:</label>
                            <input type="text" class="form-control" id="postCode" />
                        </div>
                        <div class="form-group">
                            <label for="address">Address:</label>
                            <input type="text" class="form-control" id="address" />
                        </div>
                        <div class="form-group">
                            <label for="school">School:</label>
                            <input type="text" class="form-control" id="school" />
                        </div>
                        <div class="form-group">
                            <label for="email">Email:</label>
                            <input type="text" class="form-control" id="email" />
                        </div>
                        <div class="form-group">
                            <label for="phone">Phone:</label>
                            <input type="text" class="form-control" id="phone" />
                        </div>
                        <div class="form-group">
                            <label for="mobile">Mobile:</label>
                            <input type="text" class="form-control" id="mobile" />
                        </div>
                        <div class="form-group">
                            <label for="price">Price:</label>
                            <input type="text" class="form-control" id="price" />
                        </div>
                        <div class="form-group">
                            <label for="language">Language:</label>
                            <input type="text" class="form-control" id="language" />
                        </div>
                        <div class="form-group">
                            <label for="file">Profile Pic:</label>
                            <div id="image-preview-div" style="display: none">
                                <label for="exampleInputFile">Selected image:</label>
                                <!--<br>
                                <img id="preview-img" src="noimage" style="width: 50px; height: 50px;">-->
                            </div>
                            <div class="form-group">
                                <input type="file" name="fileProfilePic" id="fileProfilePic" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="info">Info:</label>
                            <textarea class="form-control" rows="5" id="info"></textarea>
                        </div>
                        <!--<div class="checkbox">
                            <label><input type="checkbox"> Remember me</label>
                        </div>-->
                    </form>
                </div>
                <div class="modal-footer">
                    <button id="submitCreate" type="submit" class="btn btn-primary">Submit</button>
                    <button id="closeModal" type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="../vendor/jquery/jquery.min.js"></script>
    <!-- Bootstrap Core JavaScript -->
    <script src="../vendor/bootstrap/js/bootstrap.min.js"></script>
    <!-- Metis Menu Plugin JavaScript -->
    <script src="../vendor/metisMenu/metisMenu.min.js"></script>
    <!-- DataTables JavaScript -->
    <script src="../vendor/datatables/js/jquery.dataTables.min.js"></script>
    <script src="../vendor/datatables-plugins/dataTables.bootstrap.min.js"></script>
    <script src="../vendor/datatables-responsive/dataTables.responsive.js"></script>
    <!-- Custom Theme JavaScript -->
    <script src="../dist/js/sb-admin-2.js"></script>
    <!-- Page-Level Demo Scripts - Tables - Use for reference -->
    <!--<script src="../js/upload-image.js"></script>-->
    <script>
        var table;
        $(document).ready(function () {
            //var table = $('#instructor-table').DataTable({
            //    responsive: true,
            //    "ajax": '../data/mock-instructors-list.txt'
            //});

            table = $('#instructor-table').DataTable({
                'ajax': {
                    "type": "GET",
                    "url": '/api/instructor',
                    "data": {
                        "id": "data.id",
                        "name": "data.name",
                        "name": "data.email",
                        "name": "data.address",
                        "school": "data.school",
                        "phone": "data.phone",
                        "mobile": "data.mobile",
                        "price": "data.price",
                    },
                    "dataSrc": ""
                },
                'columns': [
                    { "data": "id" },
                    { "data": "name" },
                    { "data": "email" },
                    { "data": "address" },
                    { "data": "school" },
                    { "data": "phone" },
                    { "data": "mobile" },
                    { "data": "price" }
                ],
                "columnDefs": [
                    {
                        "targets": [0],
                        "visible": false,
                        "searchable": false
                    }
                ]
            });

            $('#instructor-table tbody').on('click', 'tr', function () {
                $(this).toggleClass('selected');
            });


            $('#btnEdit').click(function () {

                if (table.rows('.selected').data().length != 1) {
                    alert('Please select one record to edit.');
                    return;
                }

                $('#add-modal').modal('toggle');
                var id = table.rows('.selected').data()[0].id;
                $.ajax({
                    url: "/api/instructor/" + id,
                    type: "GET",
                    contentType: "application/json",
                    success: function (data) {
                        //console.log(data);
                        //console.log('deleted:' + value.id);
                        //table.ajax.reload(null, false);
                        $('#id').val(data.id);
                        $('#firstName').val(data.firstName);
                        $('#lastName').val(data.lastName);
                        $('#address').val(data.address);
                        $('#school').val(data.school);
                        $('#email').val(data.email);
                        $('#phone').val(data.phone);
                        $('#mobile').val(data.mobile);
                        $('#info').val(data.info);
                        $('#price').val(data.price);
                        $('#language').val(data.language);

                        //$('#fileProfilePic').val(data.id);

                    },
                    error: function () {
                    }
                });
            });


            $('#btnView').click(function () {

                if (table.rows('.selected').data().length != 1) {
                    alert('Please select one record to edit.');
                    return;
                }

                $('#add-modal').modal('toggle');
                var id = table.rows('.selected').data()[0].id;
                $.ajax({
                    url: "/api/instructor/" + id,
                    type: "GET",
                    contentType: "application/json",
                    success: function (data) {
                        //console.log(data);
                        //console.log('deleted:' + value.id);
                        //table.ajax.reload(null, false);
                        $('#id').val(data.id);
                        $('#firstName').val(data.firstName).prop('disabled', true);
                        $('#lastName').val(data.lastName).prop('disabled', true);
                        $('#address').val(data.address).prop('disabled', true);
                        $('#school').val(data.school).prop('disabled', true);
                        $('#email').val(data.email).prop('disabled', true);
                        $('#phone').val(data.phone).prop('disabled', true);
                        $('#mobile').val(data.mobile).prop('disabled', true);
                        $('#info').val(data.info).prop('disabled', true);
                        $('#price').val(data.price).prop('disabled', true);
                        $('#language').val(data.language).prop('disabled', true);

                        //$('#fileProfilePic').val(data.id);

                    },
                    error: function () {
                    }
                });
            });

            $('#btnDelete').click(function () {
                //alert(table.rows('.selected').data().length + ' row(s) selected');

                $.each(table.rows('.selected').data(), function (index, value) {


                    $.ajax({
                        url: "/api/instructor/" + value.id,
                        type: "DELETE",
                        contentType: "application/json",
                        success: function () {
                            console.log('deleted:' + value.id);
                            table.ajax.reload(null, false);
                        },
                        error: function () {
                        }
                    });


                });
            });


            $('#closeModal').click(function () {
                clearInputs();
            });

            $('#submitCreate').click(function () {
                console.log($('#id').val());
                if ($('#id').val() == '') {
                    createInstructor();
                }
                else {
                    updateInstructor();
                }
            });
            loadState();





            //$("#fileProfilePic").on("change", function (e) {
            //    var file = $(this)[0].files[0];
            //    var upload = new Upload(file);

            //    // maby check size or type here with upload.getSize() and upload.getType()

            //    // execute upload
            //    upload.doUpload();
            //});
        });


        function createInstructor() {
            var firstName = $('#firstName').val();
            var lastName = $('#lastName').val();
            var stateId = $("select#state option").filter(":selected").val();
            var suburbId = $("select#suburb option").filter(":selected").val();
            var address = $('#address').val();
            var school = $('#school').val();
            var email = $('#email').val();
            var phone = $('#phone').val();
            var mobile = $('#mobile').val();
            var info = $('#info').val();
            var price = $('#price').val();
            var language = $('#language').val();


            var instructor = {
                "firstName": firstName,
                "lastName": lastName,
                "stateId": stateId,
                "suburbId": suburbId,
                "address": address,
                "school": school,
                "email": email,
                "phone": phone,
                "mobile": mobile,
                "info": info,
                "price": parseFloat(price),
                "language": language
                //,
                //"profilePic": formData
            };


            $.ajax({
                type: 'POST',
                url: '/api/instructor',
                data: JSON.stringify(instructor),
                contentType: "application/json",
                success: function (data) {
                    uploadProfilePic(data.id);
                    table.ajax.reload(null, false);

                    clearInputs();

                    $('#add-modal').modal('toggle');
                }
            });
        }

        function updateInstructor() {
            //console.log($('#fileProfilePic')[0].files[0]);

            var id = $('#id').val();
            var firstName = $('#firstName').val();
            var lastName = $('#lastName').val();
            var stateId = $("select#state option").filter(":selected").val();
            var suburbId = $("select#suburb option").filter(":selected").val();
            var address = $('#address').val();
            var school = $('#school').val();
            var email = $('#email').val();
            var phone = $('#phone').val();
            var mobile = $('#mobile').val();
            var info = $('#info').val();
            var price = $('#price').val();
            var language = $('#language').val();


            var instructor = {
                "id": id,
                "firstName": firstName,
                "lastName": lastName,
                "stateId": stateId,
                "suburbId": suburbId,
                "address": address,
                "school": school,
                "email": email,
                "phone": phone,
                "mobile": mobile,
                "info": info,
                "price": parseFloat(price),
                "language": language
                //,
                //"profilePic": formData
            };


            $.ajax({
                type: 'PUT',
                url: '/api/instructor/' + id,
                data: JSON.stringify(instructor),
                contentType: "application/json",
                success: function (data) {

                    if ($('#fileProfilePic')[0].files[0]) {
                        updateProfilePic(id);
                    }


                    table.ajax.reload(null, false);

                    clearInputs();

                    $('#add-modal').modal('toggle');
                }
            });
        }

        function clearInputs() {
            $('#id').val('').prop('disabled', false);
            $('#firstName').prop('disabled', false);
            $('#lastName').prop('disabled', false);
            $('#address').prop('disabled', false);
            $('#school').prop('disabled', false);
            $('#email').prop('disabled', false);
            $('#phone').prop('disabled', false);
            $('#mobile').prop('disabled', false);
            $('#info').prop('disabled', false);
            $('#price').prop('disabled', false);
            $('#language').prop('disabled', false);
        }

        function uploadProfilePic(id) {
            var formData = new FormData();
            formData.append('file', $('#fileProfilePic')[0].files[0]); // myFile is the input type="file" control
            formData.append('id', id);
            var _url = '/api/instructor/profilepic';

            $.ajax({
                url: _url,
                type: 'POST',
                data: formData,
                processData: false,  // tell jQuery not to process the data
                contentType: false,  // tell jQuery not to set contentType
                success: function (result) {
                    $('#fileProfilePic').val('');
                },
                error: function (jqXHR) {
                },
                complete: function (jqXHR, status) {
                }
            });
        }

        function updateProfilePic(id) {
            var formData = new FormData();
            formData.append('file', $('#fileProfilePic')[0].files[0]); // myFile is the input type="file" control
            formData.append('id', id);
            var _url = '/api/instructor/profilepic/update';

            $.ajax({
                url: _url,
                type: 'POST',
                data: formData,
                processData: false,  // tell jQuery not to process the data
                contentType: false,  // tell jQuery not to set contentType
                success: function (result) {
                    $('#fileProfilePic').val('');
                },
                error: function (jqXHR) {
                },
                complete: function (jqXHR, status) {
                }
            });
        }

        function loadState() {
            $.ajax({
                type: 'GET',
                url: '/api/state',
                success: function (data) {
                    var state = $('#state');
                    state.empty();
                    for (var i = 0; i < data.length; i++) {
                        state.append('<option id=' + data[i].id + ' value=' + data[i].id + '>' + data[i].name + '</option>');
                    }
                    state.change();
                }
            });

            $('#state').change(function () {
                var id = $(this).find(':selected')[0].id;
                $.ajax({
                    type: 'GET',
                    url: '/api/suburb/state/' + id,
                    success: function (data) {
                        // the next thing you want to do
                        var suburb = $('#suburb');
                        suburb.empty();
                        for (var i = 0; i < data.length; i++) {
                            suburb.append('<option id=' + data[i].id + ' value=' + data[i].id + '>' + data[i].name + '</option>');
                        }
                        $('#postCode').val('');
                        suburb.change();
                    }
                });
            });

            $('#suburb').change(function () {
                var suburbId = $(this).find(':selected')[0].id;
                $.ajax({
                    type: 'GET',
                    url: '/api/suburb/' + suburbId,
                    success: function (data) {
                        $('#postCode').val(data.postCode);
                    }
                });
            });

        }

    </script>
</body>

</html>
